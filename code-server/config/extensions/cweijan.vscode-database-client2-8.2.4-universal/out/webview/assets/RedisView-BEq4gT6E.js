import{q as ue,w as A,s as y,a as P,r as w,D as j,f as S,h as $,k as o,O as q,R as G,j as l,J as u,L as T,$ as z,v as Q,I as g,t as K,o as c,C as W,e as M,g as _,K as D,aD as X,ao as de,F as Y,af as ee,ak as te,B as ce,P as me,bn as pe}from"./app-CrvaeZra.js";import{R as ve}from"./constants-DgoLmzql.js";import{d as Z}from"./objectUtil-Z6JRxuBJ.js";import{E as ye,u as fe}from"./dialogStore-HQ8W1dCM.js";import{c as _e,s as ge,p as ke,l as he}from"./common_view_utils-CNUf_t_L.js";import{E as le,a as oe}from"./index-DWVKu4oX.js";import{E as be}from"./index-D0x6NhgQ.js";import{E as we,a as xe}from"./index-DHFpw2B2.js";import{E as ne,a as Ve}from"./index-CA5ENLEs.js";import{c as Ce,s as Se}from"./codemirror-CTzG3qrd.js";import"./isEqual-CI57ebgG.js";import"./index-CGtBesQq.js";import"./index-DFnwKXRk.js";import"./index-BM16nDTw.js";import"./_baseFindIndex-D7XfJLKM.js";import"./_baseIteratee-I4jn1rod.js";import"./castArray-Bw1xMsKS.js";import"./merge-VDnJkgEN.js";import"./_initCloneObject-CqBpyGcW.js";import"./isArrayLikeObject-Bza4ElQd.js";import"./index-Dr81pKWW.js";import"./clone-DVYh2Aeu.js";import"./_baseClone-B0T5KvB6.js";import"./DatabaseType-25kBBVgA.js";const F=ue("redis",{state:()=>({remainHeight:0,edit:{name:"",ttl:-1,content:null},key:{name:"",ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(d){if(d!=null&&(this.itemModel.value=d),!this.edit.name)return A("Key name cannot be null!");y.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),$e={id:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},ze={key:1,class:"key-label key-detail-type"},Ne=P({__name:"RedisKeyInfo",setup(d){const s=w(!1),t=F(),{key:n,edit:p}=j(t),N=()=>{Q(z("confirm.deleteRedisKey")).then(()=>{y.emit("del",{key:{name:t.key.name}}),t.key={},t.edit={}})},E=()=>{y.emit("rename",{key:{name:t.key.name,newName:t.edit.name}})},x=()=>{y.emit("ttl",{key:{name:t.key.name,ttl:t.edit.ttl}})};return y.on("new",()=>{s.value=!0}),y.on("detail",()=>{s.value=!1}),setInterval(()=>{document.activeElement.tagName!=="INPUT"&&p.value.ttl>0&&(p.value.ttl-=1)},1e3),(R,f)=>{const v=le,r=oe,m=q,k=T("vsc-button"),U=T("vsc-tooltip");return c(),S("div",$e,[$("div",null,[o(m,{ref:"keyNameInput",modelValue:l(p).name,"onUpdate:modelValue":f[1]||(f[1]=h=>l(p).name=h),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:G(E,["enter"])},{prepend:u(()=>[s.value?(c(),g(r,{key:0,modelValue:l(n).type,"onUpdate:modelValue":f[0]||(f[0]=h=>l(n).type=h),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:u(()=>[o(v,{value:"string",label:"STRING"}),o(v,{value:"list",label:"LIST"}),o(v,{value:"set",label:"SET"}),o(v,{value:"zset",label:"ZSET"}),o(v,{value:"hash",label:"HASH"}),o(v,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(c(),S("span",ze,K(l(n).type),1))]),_:1},8,["modelValue"]),o(U,{title:l(z)("result.copy"),placement:"top"},{default:u(()=>[o(k,{class:"ml-1",size:"mini",icon:"el-icon-document-copy",onClick:f[2]||(f[2]=h=>l(_e)(l(p).name))})]),_:1},8,["title"])]),$("div",null,[o(m,{modelValue:l(p).ttl,"onUpdate:modelValue":f[3]||(f[3]=h=>l(p).ttl=h),size:"small",class:"mr-1",style:{width:"220px"},onKeyup:G(x,["enter"])},{prepend:u(()=>f[4]||(f[4]=[$("span",{class:"key-label"},"TTL",-1)])),_:1},8,["modelValue"]),o(k,{icon:"codicon codicon-save",size:"mini",onClick:x}),o(k,{icon:"el-icon-delete",size:"mini",type:"secondary",onClick:N})])])}}}),Ee=W(Ne,[["__scopeId","data-v-d56b00aa"]]),Re={key:0},Ie={id:"listPanel"},Te=["title","textContent"],Ue=P({__name:"RedisListView",setup(d){const s=F(),{key:t,itemModel:n,remainHeight:p}=j(s),N=w(""),E=w(""),x=w(1),R=w(100),f=w(0),v=w(!1);y.on("detail",i=>{v.value=!1,x.value=i.page.pageNum,R.value=i.page.pageSize}).on("pagination",i=>{s.key.content=i}).on("success",()=>{v.value=!1});const r=M(()=>{const i=s.itemModel.old;let e=t.value.type;return e=e.charAt(0).toUpperCase()+e.slice(1),`${i?"Edit":"Add to"} ${e}`}),m=M(()=>{const i=t.value.type;switch(i){case"list":return"Element";case"hash":return"Value";case"set":case"zset":return"Member";case"stream":return"Entry";default:return i.charAt(0).toUpperCase()+i.slice(1)}}),k=(i,e)=>{y.emit("changePage",e?i:x.value+i)},U=()=>{v.value=!0,s.itemModel={old:null,key:null,index:null,score:null,value:null}},h=M(()=>{t.value.content||(t.value.content=[]);const i=N.value,e=E.value,C=t.value.content.filter(b=>!(i&&t.value.type=="hash"&&!`${b.key}`.match(new RegExp(i,"i"))||e&&!`${b.value??b}`.match(new RegExp(e,"i"))));return f.value=t.value.count??C.length,C}),B=i=>{Q(z("confirm.deleteRedisKey")).then(()=>{y.emit("deleteLine",i)})},J=i=>{navigator.clipboard.writeText(i.value??i),X(z("common.copied"))},V=i=>{s.itemModel={...i,old:{...i}},v.value=!0};return(i,e)=>{const C=q,b=T("vsc-button"),H=T("vsc-tooltip"),ae=ye,O=Ve,se=ne,ie=be,I=xe,re=we;return["list","hash","set","zset","stream"].includes(l(t).type)?(c(),S("div",Re,[$("div",Ie,[l(t).type=="hash"?(c(),g(C,{key:0,modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=a=>N.value=a),class:"filter-input mb-2 mr-2",size:"small",style:{width:"120px"},placeholder:l(z)("result.searchField"),clearable:!0},null,8,["modelValue","placeholder"])):_("",!0),o(C,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value=a),class:"filter-input mb-2",size:"small",style:{width:"200px"},placeholder:l(z)("result.searchNotice"),clearable:!0},null,8,["modelValue","placeholder"]),o(H,{title:l(z)("common.refresh"),placement:"top"},{default:u(()=>[o(b,{type:"icon",icon:"codicon-refresh text-lg",class:"ml-2",onClick:e[2]||(e[2]=a=>{l(y).emit("refresh")})})]),_:1},8,["title"]),o(H,{title:"Add new key"},{default:u(()=>[l(t).type!="stream"?(c(),g(b,{key:0,type:"icon",icon:"codicon-add text-lg",class:"inline-block !ml-1",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:e[3]||(e[3]=a=>U())})):_("",!0)]),_:1}),o(ae,{"page-size":R.value,"onUpdate:pageSize":e[4]||(e[4]=a=>R.value=a),"current-page":x.value,"onUpdate:currentPage":e[5]||(e[5]=a=>x.value=a),small:!0,total:f.value,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:e[6]||(e[6]=a=>k(a,!0)),onNextClick:e[7]||(e[7]=()=>k(1)),onPrevClick:e[8]||(e[8]=()=>k(-1))},null,8,["page-size","current-page","total"]),o(ie,{modelValue:v.value,"onUpdate:modelValue":e[15]||(e[15]=a=>v.value=a),"show-close":!1,title:r.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:"30%",class:"new-item-dialog"},{footer:u(()=>[o(b,{type:"secondary",onClick:e[13]||(e[13]=a=>v.value=!1)},{default:u(()=>[D(K(l(z)("common.cancel")),1)]),_:1}),o(b,{type:"primary",onClick:e[14]||(e[14]=a=>l(s).saveListItem())},{default:u(()=>e[16]||(e[16]=[D("Confirm")])),_:1})]),default:u(()=>[o(se,{"label-width":"60px"},{default:u(()=>[l(t).type=="list"?(c(),g(O,{key:0,label:"Index"},{default:u(()=>[o(C,{modelValue:l(n).index,"onUpdate:modelValue":e[9]||(e[9]=a=>l(n).index=a),size:"small",disabled:""},null,8,["modelValue"])]),_:1})):_("",!0),l(t).type=="hash"?(c(),g(O,{key:1,label:"Field"},{default:u(()=>[o(C,{modelValue:l(n).key,"onUpdate:modelValue":e[10]||(e[10]=a=>l(n).key=a),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),l(t).type=="zset"?(c(),g(O,{key:2,label:"Score"},{default:u(()=>[o(C,{modelValue:l(n).score,"onUpdate:modelValue":e[11]||(e[11]=a=>l(n).score=a),size:"small"},null,8,["modelValue"])]),_:1})):_("",!0),o(O,{label:m.value},{default:u(()=>[o(C,{modelValue:l(n).value,"onUpdate:modelValue":e[12]||(e[12]=a=>l(n).value=a),size:"small"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])]),$("div",null,[o(re,{data:h.value,height:l(p),border:""},{default:u(()=>[l(t).type=="list"?(c(),g(I,{key:0,label:"Index",prop:"index",sortable:"",width:"90",align:"center"})):_("",!0),l(t).type=="hash"?(c(),g(I,{key:1,"sort-by":"key",resizable:"",sortable:"",label:"Field",align:"center",width:"200",prop:"key"})):_("",!0),l(t).type=="zset"?(c(),g(I,{key:2,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):_("",!0),l(t).type=="stream"?(c(),g(I,{key:3,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):_("",!0),o(I,{"sort-by":"value",resizable:"",sortable:"",label:m.value,align:"center"},{default:u(a=>{var L;return[$("span",{class:"item-value",title:a.row.value,textContent:K(((L=a.row)==null?void 0:L.value)||a.row)},null,8,Te)]}),_:1},8,["label"]),o(I,{label:"Operation",width:"150",align:"center"},{default:u(a=>[o(b,{type:"icon",icon:"codicon-copy",title:"View On Dialog",onClick:L=>{J(a.row)}},null,8,["onClick"]),["list","hash","set","zset"].includes(l(t).type)?(c(),g(b,{key:0,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:L=>V(a.row)},null,8,["onClick"])):_("",!0),o(b,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:L=>B(a.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):_("",!0)}}});function Le(d){if(d==null)return"";if(!Number.isFinite(d)&&(d=parseInt(d),!Number.isFinite(d)))return`${d}`;const s=d<0;s&&(d=-d);const t=["B","K","M","G","T","P","E","Z","Y"];if(d<1)return`${s?"-":""}${d} ${t[0]}`;const n=Math.min(Math.floor(Math.log(d)/Math.log(1024)),t.length-1);d=d/1024**n;const p=Number(d.toPrecision(3));return`${s?"-":""}${p}${t[n]}`}const Me={key:0,id:"stringPanel",class:"flex pr-4 mb-2 gap-x-3 items-center ml-1"},Ke={key:0,class:"flex"},Oe={class:"value-panel"},De=P({__name:"RedisStringView",setup(d){const s=F(),{key:t}=j(s),n=w(""),p=w("Text"),N=w(Se),E=M(()=>{var r;return Le(((r=n.value)==null?void 0:r.length)||0)}),x=M(()=>["string","ReJSON-RL"].includes(s.key.type));window.addEventListener("keydown",r=>{x.value&&de(r)&&r.code=="KeyS"&&R()});const R=()=>{if(!s.edit.name)return A("Key name cannot be null!");y.emit("update",{key:{name:s.key.name,newName:s.edit.name,type:s.key.type,ttl:s.edit.ttl,content:n.value}})};y.on("detailNext",()=>{f()});const f=()=>{if(!x.value)return n.value="";const r=s.edit.content,m=(r==null?void 0:r.match(/^\s*[{[]/))!=null;p.value=m?"JSON":"Text",m?v(r):n.value=r},v=r=>{var m;try{n.value=ge(ke((m=r==null?void 0:r.replace)==null?void 0:m.call(r,/ /g," ")),null,2)}catch(k){console.error(k),n.value=r}};return(r,m)=>{const k=le,U=oe,h=T("vsc-button"),B=T("vsc-tooltip"),J=ne;return c(),S(Y,null,[["string","ReJSON-RL"].includes(l(t).type)?(c(),S("div",Me,[$("div",null," Size: "+K(E.value),1),["string","ReJSON-RL"].includes(l(t).type)?(c(),S("div",Ke,[o(U,{modelValue:p.value,"onUpdate:modelValue":m[0]||(m[0]=V=>p.value=V),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:u(()=>[(c(!0),S(Y,null,ce(N.value,V=>(c(),g(k,{key:V,value:V},{default:u(()=>[D(K(V),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(B,{title:r.$t("common.refresh"),placement:"top"},{default:u(()=>[o(h,{type:"secondary",size:"micro",icon:"codicon-refresh",onClick:m[1]||(m[1]=V=>{l(y).emit("refresh")})})]),_:1},8,["title"]),o(h,{icon:"codicon codicon-save",style:{height:"27px"},onClick:R},{default:u(()=>m[3]||(m[3]=[D("Save")])),_:1})])):_("",!0)])):_("",!0),ee(o(J,null,{default:u(()=>[$("div",Oe,[o(Ce,{ref:"cmEditor",value:n.value,"onUpdate:value":m[2]||(m[2]=V=>n.value=V),language:p.value,class:"json-panel",style:me("height:"+l(s).remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[te,["string","ReJSON-RL"].includes(l(t).type)]])],64)}}}),Pe=W(De,[["__scopeId","data-v-1ea839f2"]]),Fe={class:"redis-view-container"},Be={key:0,style:{"text-align":"center"}},Je={class:"mx-2"},vt=P({__name:"RedisView",setup(d){const s=w(!0),t=F();return fe(),pe(()=>{he(100,[],n=>{t.remainHeight=n}),y.on("new",({prefix:n})=>{s.value=!1,t.key={name:n,type:ve.STRING,ttl:-1},t.edit=Z(t.key)}).on("detail",n=>{s.value=!1,t.key=n.res,t.edit=Z(n.res),y.emitImmediately("detailNext")}).on("error",n=>{A(n)}).on("success",n=>{X(n)}),y.emit("init")}),(n,p)=>(c(),S("div",Fe,[s.value?(c(),S("div",Be," loading ")):_("",!0),ee($("div",Je,[o(Ee),o(Ue),o(Pe)],512),[[te,!s.value]])]))}});export{vt as default};
